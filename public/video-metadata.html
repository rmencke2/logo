<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Video Metadata Extractor - Influzer.ai</title>
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-Q8WMQQWLT7"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-Q8WMQQWLT7');
  </script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: #0d0d0d;
      color: #ececec;
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 40px 20px;
    }
    .header {
      text-align: center;
      margin-bottom: 40px;
    }
    .header h1 {
      font-size: 36px;
      font-weight: 700;
      margin-bottom: 12px;
      background: linear-gradient(135deg, #10a37f 0%, #0d8a6a 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .header p {
      font-size: 16px;
      color: #8e8e93;
    }
    .card {
      background: #171717;
      border: 1px solid #2a2a2a;
      border-radius: 16px;
      padding: 32px;
      margin-bottom: 24px;
    }
    .form-group {
      margin-bottom: 24px;
    }
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-size: 14px;
      font-weight: 500;
      color: #ececec;
    }
    .form-group input[type="file"] {
      width: 100%;
      padding: 12px;
      background: #1f1f1f;
      border: 1px solid #2a2a2a;
      border-radius: 8px;
      color: #ececec;
      font-size: 14px;
      cursor: pointer;
      transition: border-color 0.2s;
    }
    .form-group input[type="file"]:hover {
      border-color: #10a37f;
    }
    .file-info {
      margin-top: 8px;
      font-size: 12px;
      color: #8e8e93;
    }
    .file-info.success {
      color: #10a37f;
    }
    .file-info.error {
      color: #ff453a;
    }
    .btn {
      width: 100%;
      padding: 14px;
      background: #10a37f;
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }
    .btn:hover:not(:disabled) {
      background: #0d8a6a;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(16, 163, 127, 0.3);
    }
    .btn:disabled {
      background: #2a2a2a;
      color: #6e6e73;
      cursor: not-allowed;
    }
    .loading-container {
      display: none;
      margin-top: 24px;
      background: #1f1f1f;
      border: 1px solid #2a2a2a;
      border-radius: 8px;
      padding: 24px;
      text-align: center;
    }
    .loading-container.active {
      display: block;
    }
    .spinner {
      width: 20px;
      height: 20px;
      border: 2px solid #10a37f;
      border-top-color: transparent;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      display: inline-block;
      margin-right: 12px;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .metadata-container {
      display: none;
      margin-top: 24px;
    }
    .metadata-container.active {
      display: block;
    }
    .metadata-section {
      background: #1f1f1f;
      border: 1px solid #2a2a2a;
      border-radius: 8px;
      padding: 24px;
      margin-bottom: 16px;
    }
    .metadata-section h3 {
      color: #10a37f;
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid #2a2a2a;
    }
    .metadata-row {
      display: grid;
      grid-template-columns: 200px 1fr;
      gap: 16px;
      padding: 12px 0;
      border-bottom: 1px solid #2a2a2a;
    }
    .metadata-row:last-child {
      border-bottom: none;
    }
    .metadata-label {
      color: #8e8e93;
      font-size: 14px;
      font-weight: 500;
    }
    .metadata-value {
      color: #ececec;
      font-size: 14px;
      word-break: break-word;
    }
    .error-container {
      display: none;
      margin-top: 24px;
      padding: 16px;
      background: #2a1f1f;
      border: 1px solid #2a2a2a;
      border-radius: 8px;
      color: #ff453a;
      font-size: 14px;
    }
    .error-container.active {
      display: block;
    }
    .back-link {
      display: inline-block;
      margin-bottom: 24px;
      color: #10a37f;
      text-decoration: none;
      font-size: 14px;
      transition: color 0.2s;
    }
    .back-link:hover {
      color: #0d8a6a;
    }
    .auth-message {
      text-align: center;
      padding: 24px;
      background: #1f1f1f;
      border: 1px solid #2a2a2a;
      border-radius: 8px;
    }
    .auth-message p {
      margin-bottom: 16px;
      color: #8e8e93;
    }
    .auth-buttons {
      display: flex;
      gap: 12px;
      justify-content: center;
    }
    .auth-btn {
      padding: 10px 20px;
      background: #10a37f;
      color: #fff;
      border: none;
      border-radius: 6px;
      text-decoration: none;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    .auth-btn.secondary {
      background: #1f1f1f;
      border: 1px solid #2a2a2a;
    }
    .auth-btn:hover {
      background: #0d8a6a;
    }
    .auth-btn.secondary:hover {
      background: #252525;
      border-color: #10a37f;
    }
    @media (max-width: 600px) {
      .metadata-row {
        grid-template-columns: 1fr;
        gap: 8px;
      }
      .metadata-label {
        font-weight: 600;
        color: #10a37f;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <a href="/" class="back-link">&larr; Back to Home</a>
    
    <div class="header">
      <h1>üìä Video Metadata Extractor</h1>
      <p>Extract detailed technical information from your video files</p>
    </div>

    <div id="authMessage" class="auth-message" style="display: none;">
      <p>Please sign in to use the metadata extractor</p>
      <div class="auth-buttons">
        <a href="/" class="auth-btn">Sign In</a>
        <a href="/" class="auth-btn secondary">Sign Up</a>
      </div>
    </div>

    <div id="extractorCard" class="card">
      <div class="form-group">
        <label for="videoFileInput">Select Video File</label>
        <input type="file" id="videoFileInput" accept="video/*" />
        <div id="fileInfo" class="file-info"></div>
      </div>

      <button id="extractBtn" class="btn" disabled>Extract Metadata</button>

      <div id="loadingContainer" class="loading-container">
        <div class="spinner"></div>
        <span>Extracting metadata...</span>
      </div>

      <div id="metadataContainer" class="metadata-container">
        <!-- Metadata will be displayed here -->
      </div>

      <div id="errorContainer" class="error-container"></div>
    </div>

    <div class="card" style="background: #1f1f1f;">
      <h3 style="font-size: 16px; margin-bottom: 12px; color: #ececec;">üìã What You'll Get</h3>
      <ul style="list-style: none; padding: 0; color: #8e8e93; font-size: 14px; line-height: 1.8;">
        <li>‚úì File information (size, duration, format)</li>
        <li>‚úì Video codec and resolution details</li>
        <li>‚úì Audio codec and channel information</li>
        <li>‚úì Bitrate, frame rate, and technical specs</li>
        <li>‚úì Supported formats: MP4, AVI, MOV, WebM, and more</li>
      </ul>
    </div>
  </div>

  <script>
    let currentUser = null;

    // Check authentication
    async function checkAuth() {
      try {
        const response = await fetch('/auth/me', { credentials: 'include' });
        if (response.ok) {
          const data = await response.json();
          currentUser = data.user;
          document.getElementById('authMessage').style.display = 'none';
          document.getElementById('extractorCard').style.display = 'block';
        } else {
          currentUser = null;
          document.getElementById('authMessage').style.display = 'block';
          document.getElementById('extractorCard').style.display = 'none';
        }
      } catch (err) {
        console.error('Auth check error:', err);
        currentUser = null;
        document.getElementById('authMessage').style.display = 'block';
        document.getElementById('extractorCard').style.display = 'none';
      }
    }

    // File input handling
    const videoFileInput = document.getElementById('videoFileInput');
    const extractBtn = document.getElementById('extractBtn');
    const fileInfo = document.getElementById('fileInfo');
    const loadingContainer = document.getElementById('loadingContainer');
    const metadataContainer = document.getElementById('metadataContainer');
    const errorContainer = document.getElementById('errorContainer');

    videoFileInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) {
        const fileSizeMB = (file.size / 1024 / 1024).toFixed(2);
        const maxSizeMB = 500;
        
        // Check if it's a video file
        const videoMimeTypes = ['video/mp4', 'video/x-msvideo', 'video/quicktime', 'video/webm', 'video/x-matroska'];
        const videoExtensions = ['.mp4', '.avi', '.mov', '.webm', '.mkv', '.wmv', '.3gp', '.flv'];
        const isVideo = videoMimeTypes.includes(file.type) || 
                       videoExtensions.some(ext => file.name.toLowerCase().endsWith(ext));
        
        if (file.size > maxSizeMB * 1024 * 1024) {
          fileInfo.textContent = `‚ùå File too large. Maximum size is ${maxSizeMB}MB.`;
          fileInfo.className = 'file-info error';
          extractBtn.disabled = true;
        } else if (!isVideo) {
          fileInfo.textContent = '‚ùå Please select a video file (MP4, AVI, MOV, WebM, etc.).';
          fileInfo.className = 'file-info error';
          extractBtn.disabled = true;
        } else {
          fileInfo.textContent = `‚úÖ Selected: ${file.name} (${fileSizeMB} MB)`;
          fileInfo.className = 'file-info success';
          extractBtn.disabled = false;
        }
        
        // Hide previous results/errors
        metadataContainer.classList.remove('active');
        errorContainer.classList.remove('active');
      } else {
        fileInfo.textContent = '';
        fileInfo.className = 'file-info';
        extractBtn.disabled = true;
      }
    });

    // Extract metadata function
    async function extractMetadata() {
      const file = videoFileInput.files[0];
      if (!file) {
        errorContainer.textContent = 'Please select a file first.';
        errorContainer.classList.add('active');
        return;
      }

      if (!currentUser) {
        window.location.href = '/';
        return;
      }

      // Reset UI
      loadingContainer.classList.add('active');
      metadataContainer.classList.remove('active');
      errorContainer.classList.remove('active');
      extractBtn.disabled = true;

      const formData = new FormData();
      formData.append('video', file);

      try {
        const response = await fetch('/extract-video-metadata', {
          method: 'POST',
          body: formData,
          credentials: 'include',
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.error || 'Extraction failed');
        }

        // Display metadata
        displayMetadata(data.metadata);
        loadingContainer.classList.remove('active');
        metadataContainer.classList.add('active');
      } catch (err) {
        console.error('Extraction error:', err);
        loadingContainer.classList.remove('active');
        errorContainer.textContent = err.message || 'An error occurred during metadata extraction. Please try again.';
        errorContainer.classList.add('active');
      } finally {
        extractBtn.disabled = false;
      }
    }

    function displayMetadata(meta) {
      const container = metadataContainer;
      container.innerHTML = '';

      // File Information
      const fileSection = document.createElement('div');
      fileSection.className = 'metadata-section';
      fileSection.innerHTML = `
        <h3>üìÅ File Information</h3>
        <div class="metadata-row">
          <div class="metadata-label">Filename</div>
          <div class="metadata-value">${meta.filename || 'Unknown'}</div>
        </div>
        <div class="metadata-row">
          <div class="metadata-label">File Size</div>
          <div class="metadata-value">${meta.fileSize || 'Unknown'}</div>
        </div>
        <div class="metadata-row">
          <div class="metadata-label">Duration</div>
          <div class="metadata-value">${meta.duration || 'Unknown'}</div>
        </div>
        <div class="metadata-row">
          <div class="metadata-label">Format</div>
          <div class="metadata-value">${meta.format || 'Unknown'}</div>
        </div>
        <div class="metadata-row">
          <div class="metadata-label">Format Name</div>
          <div class="metadata-value">${meta.formatLong || 'Unknown'}</div>
        </div>
        <div class="metadata-row">
          <div class="metadata-label">Bitrate</div>
          <div class="metadata-value">${meta.bitrate || 'Unknown'}</div>
        </div>
      `;
      container.appendChild(fileSection);

      // Video Stream Information
      const videoSection = document.createElement('div');
      videoSection.className = 'metadata-section';
      videoSection.innerHTML = `
        <h3>üé¨ Video Stream</h3>
        <div class="metadata-row">
          <div class="metadata-label">Codec</div>
          <div class="metadata-value">${meta.videoCodec || 'Unknown'}</div>
        </div>
        <div class="metadata-row">
          <div class="metadata-label">Codec Name</div>
          <div class="metadata-value">${meta.videoCodecLong || 'Unknown'}</div>
        </div>
        <div class="metadata-row">
          <div class="metadata-label">Resolution</div>
          <div class="metadata-value">${meta.videoResolution || 'Unknown'}</div>
        </div>
        <div class="metadata-row">
          <div class="metadata-label">Aspect Ratio</div>
          <div class="metadata-value">${meta.videoAspectRatio || 'Unknown'}</div>
        </div>
        <div class="metadata-row">
          <div class="metadata-label">Frame Rate</div>
          <div class="metadata-value">${meta.videoFrameRate || 'Unknown'}</div>
        </div>
        <div class="metadata-row">
          <div class="metadata-label">Video Bitrate</div>
          <div class="metadata-value">${meta.videoBitrate || 'Unknown'}</div>
        </div>
        <div class="metadata-row">
          <div class="metadata-label">Pixel Format</div>
          <div class="metadata-value">${meta.videoPixelFormat || 'Unknown'}</div>
        </div>
      `;
      container.appendChild(videoSection);

      // Audio Stream Information
      const audioSection = document.createElement('div');
      audioSection.className = 'metadata-section';
      audioSection.innerHTML = `
        <h3>üîä Audio Stream</h3>
        <div class="metadata-row">
          <div class="metadata-label">Codec</div>
          <div class="metadata-value">${meta.audioCodec || 'None'}</div>
        </div>
        <div class="metadata-row">
          <div class="metadata-label">Codec Name</div>
          <div class="metadata-value">${meta.audioCodecLong || 'None'}</div>
        </div>
        <div class="metadata-row">
          <div class="metadata-label">Sample Rate</div>
          <div class="metadata-value">${meta.audioSampleRate || 'None'}</div>
        </div>
        <div class="metadata-row">
          <div class="metadata-label">Channels</div>
          <div class="metadata-value">${meta.audioChannels || 'None'}</div>
        </div>
        <div class="metadata-row">
          <div class="metadata-label">Channel Layout</div>
          <div class="metadata-value">${meta.audioChannelLayout || 'None'}</div>
        </div>
        <div class="metadata-row">
          <div class="metadata-label">Audio Bitrate</div>
          <div class="metadata-value">${meta.audioBitrate || 'None'}</div>
        </div>
      `;
      container.appendChild(audioSection);
    }

    extractBtn.addEventListener('click', extractMetadata);

    // Initialize
    checkAuth();
  </script>
</body>
</html>

